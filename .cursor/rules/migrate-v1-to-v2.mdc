---
description: Migrate ERC-7730 files from v1 to v2 schema format
globs: registry/**/*.json
alwaysApply: false
---

# Migrate ERC-7730 v1 → v2

When the user wants to migrate descriptor files from v1 to the new v2 schema version.

## Command

```bash
node tools/migrate/migrate-v1-to-v2.js [options]
```

## Options

| Option | Description |
|--------|-------------|
| `--dry-run` | Preview changes without modifying files |
| `--verbose` | Show detailed transformation output |
| `--file <path>` | Migrate a single file instead of all |

## Examples

Preview all migrations:

```bash
node tools/migrate/migrate-v1-to-v2.js --dry-run --verbose
```

Migrate a single file:

```bash
node tools/migrate/migrate-v1-to-v2.js --file registry/ethena/calldata-ethena.json
```

Full migration of all registry files:

```bash
node tools/migrate/migrate-v1-to-v2.js
```

## Transformations Applied

1. **Schema reference** - Updated to `erc7730-v2.schema.json`
2. **Contract name** - `metadata.contractName` added from `context.$id`
3. **Removed fields**:
   - `metadata.info.legalName`
   - `context.contract.addressMatcher`
   - `context.contract.abi` (replaced by human-readable format keys)
   - `context.eip712.schemas` (replaced by encodeType format keys)
   - `display.formats.*.screens`
4. **Format keys** - Transformed to human-readable ABI / encodeType format
5. **Visibility modifiers**:
   - `required` array → `visible: "always"` on fields
   - `excluded` array → `visible: "never"` on fields
6. **Null cleanup** - All null values removed
